{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

    :root {
        --primary: #ff6b35;
        --primary-dark: #e85a2a;
        --secondary: #004e89;
        --secondary-dark: #003d6b;
        --success: #11998e;
        --success-dark: #0e8577;
        --danger: #ee0979;
        --danger-dark: #d60869;
        --accent: #ffa500;
        --bg-gradient: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        --card-gradient: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        --primary-gradient: linear-gradient(135deg, #ff6b35 0%, #ffa500 100%);
        --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        --danger-gradient: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
        --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        --card-shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.15);
    }

    body {
        background: var(--bg-gradient);
        font-family: 'Inter', sans-serif;
        min-height: 100vh;
        padding-bottom: 4rem;
    }

    .cart-wrapper {
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    /* Hero Section */
    .cart-hero {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f4c75 100%);
        border-radius: 30px;
        padding: 4rem 2.5rem;
        margin-bottom: 3rem;
        color: white;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
        border: 2px solid rgba(255, 107, 53, 0.3);
    }

    .cart-hero::before {
        content: '';
        position: absolute;
        top: -150px;
        right: -150px;
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, rgba(255, 107, 53, 0.2), transparent);
        border-radius: 50%;
        animation: pulse 4s ease-in-out infinite;
    }

    .cart-hero::after {
        content: 'üõí';
        position: absolute;
        bottom: -30px;
        left: 30px;
        font-size: 12rem;
        opacity: 0.08;
        animation: float 6s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.2; }
        50% { transform: scale(1.1); opacity: 0.3; }
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
    }

    .hero-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        z-index: 1;
        flex-wrap: wrap;
        gap: 1.5rem;
    }

    .hero-title {
        font-size: 3.5rem;
        font-weight: 900;
        display: flex;
        align-items: center;
        gap: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
    }

    .cart-badge {
        background: var(--primary-gradient);
        padding: 1rem 2rem;
        border-radius: 50px;
        font-size: 1.2rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 8px 30px rgba(255, 107, 53, 0.4);
        border: 3px solid white;
        animation: slideInRight 0.6s ease-out;
    }

    @keyframes slideInRight {
        from { 
            opacity: 0;
            transform: translateX(50px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Cart Layout */
    .cart-layout {
        display: grid;
        grid-template-columns: 1fr 450px;
        gap: 2.5rem;
        align-items: start;
    }

    .cart-items-section {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    /* Cart Items */
    .cart-item {
        background: white;
        border-radius: 25px;
        box-shadow: var(--card-shadow);
        border: 2px solid transparent;
        padding: 2.5rem;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
        animation: slideInUp 0.6s ease-out;
    }

    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .cart-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: var(--primary-gradient);
    }

    .cart-item:hover {
        transform: translateY(-8px);
        box-shadow: var(--card-shadow-hover);
        border-color: var(--primary);
    }

    .item-content {
        display: grid;
        grid-template-columns: 160px 1fr auto;
        gap: 2.5rem;
        align-items: center;
    }

    .item-image-container {
        width: 160px;
        height: 160px;
        border-radius: 20px;
        overflow: hidden;
        background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border: 3px solid white;
        position: relative;
    }

    .item-image-container::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, transparent 0%, rgba(255, 107, 53, 0.1) 100%);
        pointer-events: none;
    }

    .item-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.4s ease;
    }

    .cart-item:hover .item-image {
        transform: scale(1.1);
    }

    .item-placeholder {
        font-size: 4rem;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
    }

    .item-details {
        flex: 1;
    }

    .item-name {
        font-size: 1.6rem;
        font-weight: 800;
        color: #1a1a2e;
        margin-bottom: 0.75rem;
        line-height: 1.3;
    }

    .item-mechanic {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1rem;
        color: white;
        background: linear-gradient(135deg, var(--secondary), #005fa3);
        padding: 0.6rem 1.25rem;
        border-radius: 25px;
        font-weight: 700;
        box-shadow: 0 4px 15px rgba(0, 78, 137, 0.3);
    }

    .item-pricing {
        text-align: right;
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
    }

    .item-total {
        font-size: 2.5rem;
        font-weight: 900;
        background: var(--success-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 2px 10px rgba(17, 153, 142, 0.2);
    }

    .item-actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .btn-modern {
        padding: 1rem 2rem;
        border-radius: 50px;
        font-weight: 800;
        font-size: 0.95rem;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        text-decoration: none;
        white-space: nowrap;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    }

    .btn-order {
        background: var(--success-gradient);
        color: white;
    }

    .btn-order:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(17, 153, 142, 0.4);
        color: white;
    }

    .btn-remove {
        background: white;
        color: var(--danger);
        border: 3px solid var(--danger);
    }

    .btn-remove:hover {
        background: var(--danger-gradient);
        color: white;
        border-color: var(--danger);
    }

    /* Cart Summary */
    .cart-summary {
        background: white;
        border-radius: 25px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.12);
        border: 2px solid var(--primary);
        padding: 2.5rem;
        position: sticky;
        top: 2rem;
        animation: slideInLeft 0.6s ease-out;
    }

    @keyframes slideInLeft {
        from { 
            opacity: 0;
            transform: translateX(50px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .summary-header {
        font-size: 1.8rem;
        font-weight: 900;
        color: #1a1a2e;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 3px solid var(--primary);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 2px solid #f1f5f9;
    }

    .summary-label {
        font-size: 1.05rem;
        color: #64748b;
        font-weight: 600;
    }

    .summary-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1a1a2e;
    }

    .summary-value.free {
        color: var(--success);
        font-weight: 800;
    }

    .summary-total {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1.5rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 15px;
        border: 2px dashed var(--primary);
    }

    .summary-total span:first-child {
        font-size: 1.4rem;
        font-weight: 900;
        color: #1a1a2e;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .total-amount {
        font-size: 2.5rem;
        font-weight: 900;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .btn-checkout {
        width: 100%;
        padding: 1.5rem;
        background: var(--success-gradient);
        color: white;
        border: none;
        border-radius: 50px;
        font-weight: 900;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 2rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 8px 30px rgba(17, 153, 142, 0.4);
        border: 3px solid white;
    }

    .btn-checkout:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 40px rgba(17, 153, 142, 0.5);
    }

    .btn-checkout[disabled] {
        background: linear-gradient(135deg, #94a3b8, #64748b);
        cursor: not-allowed;
        box-shadow: none;
        opacity: 0.6;
        transform: none;
    }

    .btn-continue {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        width: 100%;
        padding: 1.25rem;
        border: 3px solid #e2e8f0;
        border-radius: 50px;
        margin-top: 1rem;
        text-decoration: none;
        font-weight: 800;
        color: #1a1a2e;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: white;
    }

    .btn-continue:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: rgba(255, 107, 53, 0.05);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(255, 107, 53, 0.2);
    }

    /* Empty Cart */
    .empty-cart {
        background: white;
        border-radius: 30px;
        padding: 6rem 3rem;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
        position: relative;
        overflow: hidden;
        animation: slideInUp 0.6s ease-out;
    }

    .empty-cart::before {
        content: 'üîß';
        position: absolute;
        top: -50px;
        right: -50px;
        font-size: 15rem;
        opacity: 0.05;
        transform: rotate(-15deg);
    }

    .empty-icon {
        font-size: 10rem;
        margin-bottom: 2rem;
        animation: float 3s ease-in-out infinite;
        filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.1));
    }

    .empty-title {
        font-size: 3rem;
        font-weight: 900;
        color: #1a1a2e;
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .empty-text {
        font-size: 1.3rem;
        color: #64748b;
        margin-bottom: 3rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    .btn-browse {
        display: inline-flex;
        align-items: center;
        gap: 1rem;
        padding: 1.5rem 3rem;
        background: var(--primary-gradient);
        color: white;
        border-radius: 50px;
        font-weight: 900;
        font-size: 1.2rem;
        text-decoration: none;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 10px 35px rgba(255, 107, 53, 0.4);
        transition: all 0.3s ease;
        border: 3px solid white;
    }

    .btn-browse:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 45px rgba(255, 107, 53, 0.5);
        color: white;
    }

    /* Responsive */
    @media (max-width: 1200px) {
        .cart-layout {
            grid-template-columns: 1fr 400px;
        }
    }

    @media (max-width: 992px) {
        .cart-layout {
            grid-template-columns: 1fr;
        }

        .cart-summary {
            position: static;
        }

        .item-content {
            grid-template-columns: 120px 1fr;
            gap: 1.5rem;
        }

        .item-pricing {
            grid-column: 1 / -1;
            text-align: left;
            margin-top: 1rem;
        }

        .item-actions {
            flex-direction: row;
        }
    }

    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.5rem;
        }

        .cart-badge {
            width: 100%;
            text-align: center;
        }

        .item-content {
            grid-template-columns: 1fr;
            text-align: center;
        }

        .item-image-container {
            margin: 0 auto;
        }

        .item-actions {
            flex-direction: column;
        }

        .btn-modern {
            width: 100%;
        }
    }
</style>

<div class="cart-wrapper">
    <!-- Hero Section -->
    <div class="cart-hero">
        <div class="hero-content">
            <h1 class="hero-title">
                <span>üõí</span>
                <span>Shopping Cart</span>
            </h1>
            {% if cart_items %}
            <div class="cart-badge">
                {{ cart_items|length }} Item{{ cart_items|length|pluralize }}
            </div>
            {% endif %}
        </div>
    </div>

    {% if cart_items %}
    <div class="cart-layout">
        <!-- Cart Items -->
        <div class="cart-items-section">
            {% for item in cart_items %}
            <div class="cart-item">
            <div class="item-content">
                    <div class="item-image-container">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="item-image">
                        {% else %}
                        <div class="item-placeholder">üß∞</div>
                        {% endif %}
                    </div>

                    <div class="item-details">
                        <h3 class="item-name">{{ item.product.name }}</h3>
                        <span class="item-mechanic">
                            <span>üë®‚Äçüîß</span>
                            <span>{{ item.product.mechanic.username }}</span>
                        </span>
                    </div>

                    <div class="item-pricing">
    <div class="item-total">‚Çπ{{ item.total_price }}</div>

    <!-- Quantity Update -->
    <form method="post" action="{% url 'update_cart_quantity' item.id %}" style="margin-bottom: 1rem;">
        {% csrf_token %}
        <div style="display: flex; align-items: center; justify-content: center; gap: 0.75rem;">
            <button type="submit" name="action" value="decrease" class="btn-modern" style="background:#e2e8f0; color:#000;">‚àí</button>
            <span style="font-weight:700; font-size:1.2rem;">{{ item.quantity }}</span>
            <button type="submit" name="action" value="increase" class="btn-modern" style="background:var(--primary); color:white;">+</button>
        </div>
    </form>

    <!-- Actions -->
    <div class="item-actions">
        <a href="{% url 'checkout' item.product.id %}" class="btn-modern btn-order">
            <span>‚ö°</span>
            <span>Order Now</span>
        </a>
        <form method="post" action="{% url 'remove_from_cart' item.id %}" style="width: 100%;">
            {% csrf_token %}
            <button type="submit" class="btn-modern btn-remove" style="width: 100%;">
                <span>üóëÔ∏è</span>
                <span>Remove</span>
            </button>
        </form>
    </div>
</div>

                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Order Summary -->
        <div class="cart-summary">
            <h2 class="summary-header">üìä Order Summary</h2>

            <div class="summary-row">
                <span class="summary-label">Subtotal</span>
                <span class="summary-value">‚Çπ{{ total_price }}</span>
            </div>

            <div class="summary-row">
                <span class="summary-label">Shipping</span>
                <span class="summary-value free">‚úì Free</span>
            </div>

            <div class="summary-row">
                <span class="summary-label">Tax</span>
                <span class="summary-value">‚Çπ0</span>
            </div>

            <div class="summary-total">
                <span>Total Amount</span>
                <span class="total-amount">‚Çπ{{ total_price }}</span>
            </div>

            {% if cart_items %}
            <form method="get" action="{% url 'checkout' %}">
                <button type="submit" class="btn-checkout">
                    üßæ Proceed to Checkout
                </button>
            </form>
            {% else %}
            <button type="button" class="btn-checkout" disabled>
                üßæ Proceed to Checkout
            </button>
            {% endif %}

            <a href="{% url 'shop' %}" class="btn-continue">
                <span>‚Üê</span>
                <span>Continue Shopping</span>
            </a>
        </div>
    </div>

    {% else %}
    <!-- Empty Cart State -->
    <div class="empty-cart">
        <div class="empty-icon">üõí</div>
        <h2 class="empty-title">Your Cart is Empty</h2>
        <p class="empty-text">Looks like you haven't added any automotive parts or services yet. Start shopping now!</p>
        <a href="{% url 'shop' %}" class="btn-browse">
            <span>üîç</span>
            <span>Browse Products</span>
        </a>
    </div>
    {% endif %}
</div>

{% endblock %}